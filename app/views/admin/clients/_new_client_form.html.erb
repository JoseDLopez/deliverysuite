<script src="//maps.google.com/maps/api/js?key=AIzaSyCp5ZLMmxEH6dtxWB8Ni20RWLMZIDuthsE"></script>


<%= semantic_form_for [:admin, @client] do |f| %>
	<%= f.inputs "Básico" do %>
		<%= f.input :name, :label => "Nombre" %>
		<%= f.input :lastname, :label => "Apellido" %>
		<%= f.input :email, :label => "Correo Electrónico" %>
		<%= f.input :phone, :label => "Número celular" %>
		<%= f.input :rut, :label => "RUT" %>
	<% end %>
	<%= f.inputs "Ubicación" do %>
		<%= f.input :address, :label => "Dirección" %>
		<%= f.input :latitude %>
		<%= f.input :longitude %>
	<% end %>
  <br>

	<%= f.inputs "Localización en el Mapa" do %>
		<%= yield :scripts %>
		<div id="basic_map" style='height: 350px;'></div>
	<% end %>

  <%= f.actions %>
<% end %>
<%= @client.longitude %>




<script>

$( document ).ready(function() {
	marcador =[];
    console.log( "ready!" );
    lat = "<%= @client.latitude %>";
    lon = "<%= @client.longitude %>";
    if (lat == ""){
    	lat = "-33.453703";
    }
    if (lon == ""){
    	lon = "-70.633799";
    }
    handler = Gmaps.build('Google');
	mapita = handler.buildMap({
		internal: {id: 'basic_map'},
		provider: {
			center: new google.maps.LatLng(lat,lon),
			zoom: 16
		}
	},function(){
		if (lat !="-33.453703"){
			setClientMarker(lat,lon);
		}

		google.maps.event.addListener(mapita.getServiceObject(), "rightclick", function(evt) {
			alert("Nueva ubicación de usuario =)");
			var mylatlang = evt.latLng;
			var lati = mylatlang.lat();
			var long = mylatlang.lng();
			$("#client_latitude").val(lati);
			$("#client_longitude").val(long);
			setClientMarker(lati,long);
		});


		function setClientMarker(lat,lon){
			if (marcador.length != 0){
			marcador.visible(false);	
			}
			
			markers = handler.addMarkers([
				{
					"lat": lat,
					"lng": lon,
					"infowindow": "<%= @client.name %>"
				}
			]);
			marcador = markers;
			var latilong = new google.maps.LatLng(lat,lon);
			mapita.getServiceObject().panTo(latilong);
		}






	}
	);

});




</script>